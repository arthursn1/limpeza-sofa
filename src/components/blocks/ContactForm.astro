---
import type { z } from "astro/zod";
import { ContactFormSchema } from "../../types/schema";

type Props = z.infer<typeof ContactFormSchema>['props'];

const { eyebrow, title, description, info, mapUrl, formLabels } = Astro.props;

// SVGs para os ícones (equivalentes ao Lucide React)
const icons = {
  phone: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>`,
  mapPin: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`,
  clock: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
  send: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>`
};
---

<section id="contato" class="py-24 bg-muted/50">
  <div class="container mx-auto px-4">
    
    <div class="text-center max-w-2xl mx-auto mb-16">
      {eyebrow && (
        <span class="inline-block text-primary font-semibold text-sm uppercase tracking-wider mb-4">
          {eyebrow}
        </span>
      )}
      <h2 class="font-sans text-3xl md:text-4xl font-bold text-foreground mb-4">
        {title}
      </h2>
      <p class="text-muted-foreground text-lg">
        {description}
      </p>
    </div>

    <div class="grid lg:grid-cols-2 gap-12 max-w-5xl mx-auto">
      
      <div class="space-y-8">
        <div class="space-y-6">
          
          <a href={`tel:${info.phone.replace(/\D/g, '')}`} class="flex items-start gap-4 hover:opacity-80 transition-opacity group">
            <div class="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0 text-primary group-hover:bg-primary/20 transition-colors">
              <Fragment set:html={icons.phone} />
            </div>
            <div>
              <h4 class="font-semibold text-foreground">Telefone</h4>
              <p class="text-muted-foreground">{info.phone}</p>
            </div>
          </a>

          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0 text-primary">
              <Fragment set:html={icons.mapPin} />
            </div>
            <div>
              <h4 class="font-semibold text-foreground">Área de Atendimento</h4>
              <p class="text-muted-foreground">{info.address}</p>
            </div>
          </div>

          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0 text-primary">
              <Fragment set:html={icons.clock} />
            </div>
            <div>
              <h4 class="font-semibold text-foreground">Horário</h4>
              <p class="text-muted-foreground">{info.hours}</p>
            </div>
          </div>
          
        </div>

        <div class="rounded-2xl overflow-hidden h-64 bg-card border border-border shadow-sm">
          <iframe 
            src={mapUrl} 
            width="100%" 
            height="100%" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            title="Localização"
          >
          </iframe>
        </div>
      </div>

      <div class="bg-card rounded-2xl p-8 border border-border shadow-card">
        <form class="space-y-6" id="contact-form">
          
          <div>
            <label for="name" class="block text-sm font-medium text-foreground mb-2">
              {formLabels.name}
            </label>
            <input 
              type="text" 
              id="name" 
              name="name"
              placeholder="Seu nome"
              class="flex h-12 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
              required
            />
          </div>

          <div>
            <label for="phone" class="block text-sm font-medium text-foreground mb-2">
              {formLabels.phone}
            </label>
            <input 
              type="tel" 
              id="phone" 
              name="phone"
              placeholder="(11) 99999-9999"
              class="flex h-12 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
              required
            />
          </div>

          <div>
            <label for="message" class="block text-sm font-medium text-foreground mb-2">
              {formLabels.message}
            </label>
            <textarea 
              id="message" 
              name="message"
              rows="4" 
              placeholder="Descreva o serviço que precisa..."
              class="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-y"
              required
            ></textarea>
          </div>

          <button 
            type="submit" 
            class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-12 px-8 w-full"
          >
            <span id="button-text">{formLabels.button}</span>
            <span id="button-icon" class="ml-2">
              <Fragment set:html={icons.send} />
            </span>
          </button>

        </form>
      </div>

    </div>
  </div>
</section>

<script>
  // Script simples para feedback de envio
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const button = form?.querySelector('button');
  const buttonText = document.getElementById('button-text');
  
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!button || !buttonText) return;

      // Estado de loading
      const originalText = buttonText.innerText;
      buttonText.innerText = 'Enviando...';
      button.disabled = true;

      // Simulação de delay de rede
      await new Promise(resolve => setTimeout(resolve, 1500));

      // Sucesso
      alert('Mensagem enviada com sucesso! Entraremos em contato em breve.');
      
      // Reset
      form.reset();
      buttonText.innerText = originalText;
      button.disabled = false;
    });
  }
</script>